# Описание проекта
Это тестовый проект c использованием технологий:
Spring Boot, Spring Web, Spring Data, Spring Security, JWT, Liquibase, JUnit 5, Testcontainers.

Замечание: в связи с использованием последних версий библиотек некоторые механизмы помечены как deprecated. Они будут постепенно обновляться на актуальные. 

## Эндпоинты
В программе введено два эндпоинта:

> /api/login
>
> /api/message

### Эндпоинт /api/login
Используется для получения токена. Должен передаваться логин и пароль в виде JSON
 
>{ 
>    name: "имя пользователя", 
>    password: "пароль" 
>}
 
Сервером будет выдан токен в следующем виде 
>{token: "токен"}


### Эндпоинт /api/message
Используется для работы с сообщениями в формате JSON. В запрос нужно добавлять заголовок Authorization с указанием полученного токена в формате "Bearer_ТОКЕН". Нижнее подчеркивание обязательно.

Отправка сообщения
>{
>    name: "имя пользователя",
>    message: "пароль"
>}

Если будет нижеприведенный формат - система выдаст указанное количество последних сообщений 
>{
>    name: "имя пользователя",
>    message: "history 10"
>}


### Пользователи
Так как проект демонстрационно-тестовый то в программе через liquibase по-умолчанию создаются два пользователя с комбинациями учетных данных:
> admin/admin
> 
> user/user

Интерфейса управления пользователями не предусматривалось.

### База данных
В качестве БД выбрана PostgreSQL 14.4.
Доступ к БД по умолчанию осуществляется со следующим настройками:

Server: localhost

Port: 5432

Schema: jwtdemo

login: postgres

password: postgres


### Тесты
Для тестов связанных с БД используется testcontainers, поэтому для проведения тестов требуется запущенный сервис Docker.

### Запуск приложения
При запуске можно передавать приложению переменные^

**SERVER_PORT** - порт на котором запускается приложение (по умолчанию 9876)
 
**PG_URL** - url подключения к БД (по-умолчанию "jdbc:postgresql://127.0.0.1:5432/jwtdemo") 
 
**PG_USER** - пользователь БД (по-умолчанию postgres)
 
**PG_PASSWORD** - пароль пользователя БД (по-умолчанию postgres)
 
**JWT_TOKEN** - секретный токен JWT (по-умолчанию bigsecrettesttaskjwttokeneyakubovskiy)
 
**JWT_EXPIRED** - время истечения пароля в миллисекундах (по-умолчанию 3600000, 1 час)


Пример команды запуска
> java -jar testtask_spring_jwt.jar --SERVER_PORT=8765 --JWT_EXPIRED=4000000


### Docker
Проект можно запустить в контейнере.

Для этого можно изменить [Dockerfile](Dockerfile) установив в нем нужные значения переменных запуска приложения.
После чего для запуска можно использовать команды

>docker build -t jwtdemo:v1.0 .

>docker run -d -p 9876:9876 --name ContainerUserNameID jwtdemo:v1.0

### Дополнительные ресурсы

* [Файл с тестовыми запросами curl](curl)
